<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Interface</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
</head>

<body>
        <!-- Theme Toggle Button -->
        <button id="theme-toggle-btn" class="action-button" title="Toggle Theme">
            <svg class="theme-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <!-- Sun icon -->
                <circle class="sun" cx="12" cy="12" r="5" stroke="currentColor" stroke-width="2"/>
                <path class="sun" d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72l1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2"/>
                <!-- Moon icon -->
                <path class="moon" d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="currentColor" stroke-width="2" fill="currentColor"/>
                <!-- System icon - Split circle icon - half white, half dark -->
                <defs>
                    <clipPath id="leftHalf">
                        <rect x="0" y="0" width="12" height="24"/>
                    </clipPath>
                    <clipPath id="rightHalf">
                        <rect x="12" y="0" width="12" height="24"/>
                    </clipPath>
                </defs>
                <!-- Dark half (left) -->
                <circle class="system" cx="12" cy="12" r="8" fill="currentColor" clip-path="url(#leftHalf)"/>
                <!-- Light half (right) -->
                <circle class="system" cx="12" cy="12" r="8" fill="none" stroke="currentColor" stroke-width="2" clip-path="url(#rightHalf)"/>
                <!-- Circle outline -->
                <circle class="system" cx="12" cy="12" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
            </svg>
        </button>
        {% if is_authenticated and user_info %}
        <button id="user-profile-btn" class="user-profile-btn" title="{{ user_info.name }}">
            <img src="{{ user_info.picture }}" alt="{{ user_info.name[0] | upper }}" class="user-profile-img">
        </button>
        <div id="user-profile-dropdown" class="user-profile-dropdown">
            <div class="user-profile-info">
                <div class="user-profile-name">{{ user_info.name }}</div>
                <div class="user-profile-email">{{ user_info.email }}</div>
            </div>
            <div class="user-profile-actions">
                <button onclick="window.location.href='/logout'" class="user-profile-logout">Logout</button>
            </div>
        </div>
        {% endif %}
    <div id="container">
        <div id="menu-container">
            <div id="menu-header">
                <button class="action-button" id="menu-button" title="Close Menu">
                    <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 19.7333V12.2667C22 11.9556 21.8667 11.7444 21.6 11.6333C21.3333 11.5222 21.0889 11.5778 20.8667 11.8L17.6 15.0667C17.3333 15.3333 17.2 15.6444 17.2 16C17.2 16.3556 17.3333 16.6667 17.6 16.9333L20.8667 20.2C21.0889 20.4222 21.3333 20.4778 21.6 20.3667C21.8667 20.2556 22 20.0444 22 19.7333ZM6.66667 28C5.93333 28 5.30578 27.7391 4.784 27.2173C4.26222 26.6956 4.00089 26.0676 4 25.3333V6.66667C4 5.93333 4.26133 5.30578 4.784 4.784C5.30667 4.26222 5.93422 4.00089 6.66667 4H25.3333C26.0667 4 26.6947 4.26133 27.2173 4.784C27.74 5.30667 28.0009 5.93422 28 6.66667V25.3333C28 26.0667 27.7391 26.6947 27.2173 27.2173C26.6956 27.74 26.0676 28.0009 25.3333 28H6.66667ZM13.3333 25.3333H25.3333V6.66667H13.3333V25.3333Z" fill="currentColor" />
                    </svg>                
                </button>
            </div>
            <div id="menu-content">
                <div class="menu-item" id="instructions-container">
                    <h2>INSTRUCTIONS</h2>
                    <textarea class="menu-value" id="instructions-textarea"
                        placeholder="Enter your instructions for the generator..."></textarea>
                </div>
                <div class="horizontal-separator"></div>
                <div class="menu-item" id="conf-container">
                    <h2>CONFIDENCE VALUE</h2>
                    <p class="menu-value" id="conf-value">0%</p>
                </div>
                <div class="menu-item" id="exp-container">
                    <h2>EXPLANATION</h2>
                    <div class="menu-value" id="exp-value"></div>
                </div>
                <div class="menu-item" id="info-container">
                    <h2>MISSING INFORMATION</h2>
                    <div class="menu-value" id="info-value"></div>
                </div>
                <div class="menu-item" id="amb-container">
                    <h2>AMBIGUITY</h2>
                    <div class="menu-value" id="amb-value"></div>
                </div>
            </div>
            <div id="menu-footer">
                <p id="rights-reserved">All Rights Reserved (c) FalkorDB 2025 | <a class="link"
                        href="https://falkordb.com" target="_blank">falkordb.com</a></p>
            </div>
        </div>
        <div id="chat-container" class="chat-container">
            <button class="action-button" id="side-menu-button" title="Open Menu">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M22 19.7333V12.2667C22 11.9556 21.8667 11.7444 21.6 11.6333C21.3333 11.5222 21.0889 11.5778 20.8667 11.8L17.6 15.0667C17.3333 15.3333 17.2 15.6444 17.2 16C17.2 16.3556 17.3333 16.6667 17.6 16.9333L20.8667 20.2C21.0889 20.4222 21.3333 20.4778 21.6 20.3667C21.8667 20.2556 22 20.0444 22 19.7333ZM6.66667 28C5.93333 28 5.30578 27.7391 4.784 27.2173C4.26222 26.6956 4.00089 26.0676 4 25.3333V6.66667C4 5.93333 4.26133 5.30578 4.784 4.784C5.30667 4.26222 5.93422 4.00089 6.66667 4H25.3333C26.0667 4 26.6947 4.26133 27.2173 4.784C27.74 5.30667 28.0009 5.93422 28 6.66667V25.3333C28 26.0667 27.7391 26.6947 27.2173 27.2173C26.6956 27.74 26.0676 28.0009 25.3333 28H6.66667ZM13.3333 25.3333H25.3333V6.66667H13.3333V25.3333Z" fill="currentColor"/>
                </svg>   
            </button>
            <div class="chat-header">
                <img src="{{ url_for('static', filename='public/icons/logo.svg') }}" alt="Chat Logo" class="logo">
                <h1> Text-to-SQL(Natural Language to SQL Generator)</h1>
                <div class="button-container">
                    <select title="Select Database" id="graph-select">
                        <option value="">Loading...</option>
                    </select>
                    <div class="vertical-separator"></div>
                    <input title="Upload Schema" id="schema-upload" type="file" accept=".json" style="display: none;" tabindex="-1" />
                    <label for="schema-upload" id="custom-file-upload">
                        Upload Schema
                    </label>
                    <div class="vertical-separator"></div>
                    <label id="open-pg-modal">
                        Connect Postgres
                    </label>
                </div>
            </div>
            <div class="chat-messages" id="chat-messages">
            </div>
            <div class="chat-input">
                <div class="suggestions-input-container">
                    <ul class="suggestions-container" id="suggestions-container">
                        <li class="suggestion-item loading">
                            <button title="Loading suggestion..." id="suggestion-1">
                                <p></p>
                            </button>
                        </li>
                        <li class="suggestion-item loading">
                            <button title="Loading suggestion..." id="suggestion-2">
                                <p></p>
                            </button>
                        </li>
                        <li class="suggestion-item loading">
                            <button title="Loading suggestion..." id="suggestion-3">
                                <p></p>
                            </button>
                        </li>
                    </ul>
                    <div class="input-container" id="input-container">
                        <input type="text" id="message-input" placeholder="Describe the SQL query you want..." />
                        <button class="input-button" title="Submit" id="submit-button">
                            <img src="{{ url_for('static', filename='public/icons/submit.svg') }}" alt="Submit">
                        </button>
                        <button class="input-button" title="Pause" id="pause-button">
                            <img src="{{ url_for('static', filename='public/icons/pause.svg') }}" alt="Pause">
                        </button>
                        <button id="reset-button" class="action-button">Reset</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="gradient"></div>
    <div id="google-login-modal" class="google-login-modal">
        <div class="google-login-modal-content">
            <h2>Welcome to Text-to-SQL</h2>
            <p>Please login to continue</p>
            <a href="/login/google" class="google-login-btn">
                <img src="{{ url_for('static', filename='public/icons/google.svg') }}"  alt="Google logo" class="google-login-logo">Sign in with Google
            </a>
        </div>
    </div>
    <div id="pg-modal" class="pg-modal">
        <div class="pg-modal-content">
            <h2 class="pg-modal-title">Connect to Postgres</h2>
            <input type="text" id="pg-url-input" class="pg-modal-input" placeholder="postgres://user:pass@host:port/db" />
            <div class="pg-modal-actions">
                <button id="pg-modal-connect" class="pg-modal-btn pg-modal-connect">
                    <span class="pg-modal-connect-text">Connect</span>
                    <span class="pg-modal-loading-spinner" style="display: none;">
                        <span class="spinner"></span>
                        Loading Schema...
                    </span>
                </button>
                <button id="pg-modal-cancel" class="pg-modal-btn pg-modal-cancel">Cancel</button>
            </div>
        </div>
    </div>
    {# Set authentication state for JS before loading chat.js #}
    <script>
      window.isAuthenticated = {{ 'true' if is_authenticated else 'false' }};
      {% if user_info %}
      window.currentUser = {
          name: "{{ user_info.name|e }}",
          email: "{{ user_info.email|e }}",
          picture: "{{ user_info.picture|e }}"
      };
      {% else %}
      window.currentUser = null;
      {% endif %}
    </script>
    <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
</body>

</html>